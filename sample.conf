# ==================================================================
# WEBSERV CONFIGURATION FILE SAMPLE
# ==================================================================
# This file demonstrates all supported configuration directives
# and their various usage patterns based on the project requirements.

# ==================================================================
# DIRECTIVE REFERENCE AND EXAMPLES
# ==================================================================

# listen directive:
#     Specifies the port(s) and optional host to listen on
#     Formats supported:
#       - port only: listen 8080;
#       - host:port: listen 127.0.0.1:8080;
#       - multiple ports: listen 443 80; (space-separated)
#       - multiple listen directives allowed
#     Note: SSL flag is ignored as per requirements
listen 443 80;
listen 127.0.0.1:8080;
listen 8080;

# server_name directive:
#     Defines the server names that this server block responds to
#     Formats supported:
#       - single name: server_name example.com;
#       - multiple names: server_name example.com www.example.com; (space-separated)
#     First server block for a host:port combination becomes the default
server_name seayeo.42.fr hi.com;
server_name example.com;

# error_page directive:
#     Maps HTTP error codes to custom error pages
#     Formats supported:
#       - single code: error_page 404 /404.html;
#       - multiple codes: error_page 500 502 503 504 /5xx.html;
#       - redirect: error_page 404 = /custom_404.php;
#       - named location: error_page 500 = @fallback;
error_page 404 /404.html;
error_page 500 502 503 504 /errors/server_error.html;
error_page 403 /errors/forbidden.html;

# root directive:
#     Sets the document root for the server or location
#     Used to resolve file paths for static content
root /var/www/html;

# index directive:
#     Defines default files to serve when a directory is requested
#     Multiple files can be specified (space-separated)
#     Files are checked in order until one is found
index index.html index.htm index.php;

# autoindex directive:
#     Enables/disables directory listing when no index file is found
#     Values: on | off
autoindex on;

# client_max_body_size directive:
#     Sets the maximum allowed size of the client request body
#     Useful for file uploads
#     Format: size in bytes, or with K/M/G suffix
client_max_body_size 1M;

# allowed_methods directive:
#     Restricts which HTTP methods are allowed for a location
#     Required methods: GET, POST, DELETE (as per PDF requirements)
#     Multiple methods can be specified (space-separated)
allowed_methods GET POST DELETE;

# return directive:
#     Performs HTTP redirects
#     Format: return code [text|URL];
#     Common codes: 301 (permanent), 302 (temporary)
return 301 /new-location/;

# try_files directive:
#     Attempts to serve files in the specified order
#     Falls back to the last parameter if no files are found
try_files $uri $uri/ /index.html;

# CGI-related directives (for PHP and other CGI):
# fastcgi_pass directive:
#     Passes requests to a FastCGI server
fastcgi_pass 127.0.0.1:9000;

# fastcgi_param directive:
#     Sets parameters to pass to the FastCGI server
fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;

# ==================================================================
# SERVER BLOCK EXAMPLES
# ==================================================================

# Basic static file server
server {
    listen 80;
    server_name localhost example.com;
    root /var/www/html;
    index index.html index.htm;
    
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;
    
    location / {
        try_files $uri $uri/ =404;
    }
}

# Multi-port server with SSL and regular HTTP
server {
    listen 443 80;
    server_name seayeo.42.fr;
    root /var/www/wordpress;
    index index.php index.html;
    
    error_page 404 /404.html;
    
    location / {
        try_files $uri $uri/ /index.php?$args;
    }
    
    location ~ \.php$ {
        fastcgi_pass wordpress:9000;
        fastcgi_param SCRIPT_FILENAME /var/www/wordpress$fastcgi_script_name;
    }
}

# API server with method restrictions
server {
    listen 8080;
    server_name api.example.com;
    root /var/www/api;
    
    # Read-only endpoints
    location /api/read/ {
        allowed_methods GET;
    }
    
    # Write endpoints
    location /api/write/ {
        allowed_methods POST;
    }
    
    # Full CRUD endpoints
    location /api/crud/ {
        allowed_methods GET POST DELETE;
    }
}

# File server with uploads and directory listing
server {
    listen 8081;
    server_name files.example.com;
    root /var/www/files;
    
    # Public downloads with directory listing
    location /downloads/ {
        root /var/downloads;
        autoindex on;
        allowed_methods GET;
    }
    
    # File uploads
    location /upload/ {
        allowed_methods POST;
        client_max_body_size 100M;
    }
    
    # File management (view, upload, delete)
    location /manage/ {
        allowed_methods GET POST DELETE;
        client_max_body_size 50M;
    }
}

# Server with complex error handling
server {
    listen 8082;
    server_name errors.example.com;
    root /var/www/errors;
    
    # Multiple error pages for different error classes
    error_page 400 401 402 403 404 /errors/4xx.html;
    error_page 500 501 502 503 504 505 /errors/5xx.html;
    
    # Specific error page for 418 I'm a teapot
    error_page 418 /errors/teapot.html;
    
    # Error page with redirect
    error_page 404 = /custom_404.php;
    error_page 500 = @fallback;
    
    location / {
        try_files $uri $uri/ =404;
    }
    
    location @fallback {
        return 302 /maintenance.html;
    }
}

# Server with nested locations and different roots
server {
    listen 8083;
    server_name nested.example.com;
    root /var/www/default;
    
    # Root location
    location / {
        root /var/www/home;
        index index.html;
    }
    
    # Static assets
    location /static/ {
        root /var/www/assets;
        autoindex on;
    }
    
    # API with nested routes
    location /api/ {
        root /var/www/api;
    }
    
    # More specific API route (takes priority over /api/)
    location /api/v1/ {
        root /var/www/api/v1;
        allowed_methods GET POST;
    }
    
    # Admin area with restrictions
    location /admin/ {
        root /var/www/admin;
        allowed_methods GET POST DELETE;
        client_max_body_size 10M;
    }
}

# Server with redirects
server {
    listen 8084;
    server_name redirect.example.com;
    root /var/www/redirect;
    
    # Permanent redirect for old URLs
    location /old/ {
        return 301 /new/;
    }
    
    # Temporary redirect
    location /temp/ {
        return 302 /permanent/;
    }
    
    # Normal locations
    location /new/ {
        root /var/www/new;
    }
    
    location /permanent/ {
        root /var/www/permanent;
    }
}

# Multiple servers on same port (first is default)
server {
    listen 8085;
    server_name first.example.com;
    root /var/www/first;
    
    location / {
        index index.html;
    }
}

server {
    listen 8085;
    server_name second.example.com;
    root /var/www/second;
    
    location / {
        index index.html;
    }
}

# Server without explicit server_name (uses default)
server {
    listen 8086;
    root /var/www/default;
    
    location / {
        autoindex on;
    }
}