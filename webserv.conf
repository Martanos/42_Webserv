# ==================================================================
# CGI SHOWCASE CONFIGURATION FOR WEBSERV
# ==================================================================

# Configuration for the CGI showcase server running on localhost:3000
# This configuration serves static HTML/PHP files, handles CGI scripts,
# and supports file uploads with proper error handling.

http {
server {
    # Server listening port
    listen 3000;

    # Server name (domain)
    server_name localhost;


    # Root directory for serving static files
    root /home/sean/projects/webserv/www/html;

    # Default index files to look for
    index index.php index.html index.htm;

    # Maximum client request body size (for uploads)
    client_max_body_size 10M;

    # Error page mappings
    error_page 400 /responses/400.php;
    error_page 403 /responses/403.php;
    error_page 500 /responses/500.php;

    # Static file location - serves HTML/JS/CSS etc.
    location / {
        # Allow GET requests for static files
        allowed_methods GET POST;
    }

    # PHP CGI handling - executes .php files with php-cgi
    location ~ \.php$ {
        # CGI executable path
        cgi_path /usr/bin/php-cgi; 
        # Allow GET/POST for PHP scripts
        allowed_methods GET POST DELETE;

        # CGI environment parameters (webserv handles most CGI vars automatically)
        cgi_param REQUEST_METHOD GET;
        cgi_param CONTENT_TYPE "";
        cgi_param CONTENT_LENGTH 0;
    }

    # Python CGI handling - executes .py files with python3
    location ~ \.py$ {
        # Allow GET/POST for Python scripts
        allowed_methods GET POST;

        # CGI executable path
        cgi_path /usr/bin/python3;

        # CGI environment parameters (webserv handles most CGI vars automatically)
        cgi_param REQUEST_METHOD GET;
        cgi_param CONTENT_TYPE "";
        cgi_param CONTENT_LENGTH 0;
    }

    location /upload {
        # Allow POST requests for file uploads
        allowed_methods POST;

        # CGI executable path for handling uploads
        cgi_path /home/sean/projects/webserv/www/cgi/upload.py;

        # CGI environment parameters (webserv handles most CGI vars automatically)
        cgi_param REQUEST_METHOD POST;
        cgi_param CONTENT_TYPE "";
        cgi_param CONTENT_LENGTH 0;
    }
}
}
